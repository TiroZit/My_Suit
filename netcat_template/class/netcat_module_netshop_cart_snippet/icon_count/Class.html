<!-- FormPrefix --><?= $f_AdminCommon; ?>
<style>
    <?php if ($cc_settings['iconColor'] !== 'inherit') { ?>
    #<?= $nc_block_id; ?> .tpl-icon path {fill:var(--tpl-color-<?= $cc_settings['iconColor']; ?>);}
    <?php } ?>
    <?php if ($cc_settings['iconDecor'] !== 'none' && $cc_settings['iconDecorColor'] !== 'inherit') { ?>
    #<?= $nc_block_id; ?> .tpl-icon[class*='icon-decor-'] { border: 1px solid var(--tpl-color-<?= $cc_settings['iconDecorColor']; ?>); }
    #<?= $nc_block_id; ?> .tpl-icon[class*='icon-decor-'][class*='-fill'] { background-color: var(--tpl-color-<?= $cc_settings['iconDecorColor']; ?>); }
    <?php } ?>
    #<?= $nc_block_id; ?> {--tpl-icon-space: <?= str_replace(",", ".", ($cc_settings['textSpace']/100)); ?>em;}
</style>
<?php
$icon_class = array();
$icon_class[] = "tpl-icon";
$icon_class[] = "tpl-text-" . $cc_settings['iconSize'];
$icon_class[] = $cc_settings['iconDecor'] !== 'none' ? "icon-decor-" . $cc_settings['iconDecor'] : "";

$icon = nc_get_svg_for_embedding($nc_core->DOCUMENT_ROOT . $nc_core->HTTP_TEMPLATE_PATH . 'icon/font_awesome/shopping-basket.svg');
$_icon = "<span class='" . implode(" ", $icon_class) . "'>" . $icon . "</span>";
$_count = "";
$nc_cart_items_count = $nc_cart->get_item_count($cc_settings['countAll'] === 'on' ? true : false);

if ($nc_cart_items_count > 0) {
    $_count = $nc_cart_items_count . " " . $nc_core->lang->get_numerical_inclination($nc_cart_items_count,
            array('товар', 'товара', 'товаров'));
} else {
    $_count = "ничего нет";
}
$_count = "<span class='cart-count'>в корзине $_count</span>";
?>
<a href="<?= nc_folder_path($current_catalogue['Netshop_Cart_Sub_ID']); ?>"
   class="cart-row display-<?= $cc_settings['showAs']; ?> <?= $nc_cart_items_count == 0 ? "disabled" : ""; ?>">
    <?= $_icon . $_count; ?>
</a>
<!-- /FormPrefix -->

<!-- RecordTemplate --><?= $f_AdminButtons; ?><!-- /RecordTemplate -->

<!-- FormSuffix --><script>
    if (typeof pluralForm != 'function') {
        /**
         * Склонение русских слов
         * @param {Number} itemQuantity  Количество товаров
         * @param {String} one           «товар»
         * @param {String} two           «товара»
         * @param {String} many          «товаров»
         * @returns {String}
         */
        function pluralForm(itemQuantity, one, two, many) {
            itemQuantity = Math.abs(itemQuantity) % 100;
            let underHundred = itemQuantity % 10,
                result = many;

            if (underHundred > 1 && underHundred < 5) {
                result = two;
            }
            if (underHundred === 1) {
                result = one;
            }
            if (itemQuantity > 10 && itemQuantity < 20) {
                result = many;
            }

            return result;
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        jQuery(document).on('ncNetshopCartUpdate', function (event) {
            let data = event.originalEvent.detail;
            let itemsCount = 0;
            // Обновим кол-во товаров в корзине
            <?php if ($cc_settings['countAll'] === 'on') { ?>
            itemsCount = data.cart.TotalItemCount;
            <?php } else { ?>
            itemsCount = data.cart.TotalCount;
            <?php } ?>
            if (itemsCount > 0) {
                jQuery('#<?= $nc_block_id; ?> a').removeClass('disabled');
                jQuery('#<?= $nc_block_id; ?> .cart-count').each(function () {
                    jQuery(this).html("в корзине " + itemsCount + " " + pluralForm(itemsCount, 'товар', 'товара', 'товаров') + "");
                });
            } else {
                jQuery('#<?= $nc_block_id; ?> a').addClass('disabled');
                jQuery('#<?= $nc_block_id; ?> .cart-count').each(function () {
                    jQuery(this).html("в корзине ничего нет");
                });
            }
        });
    });
</script>
<!-- /FormSuffix -->