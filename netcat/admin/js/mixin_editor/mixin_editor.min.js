(function(f){function w(a){return Object.keys(a).reduce(function(b,c){if("object"===typeof a[c]&&a[c]){var d=w(a[c]);Object.keys(d).forEach(function(e){b[c+"."+e]=d[e]})}else b[c]=a[c];return b},{})}function x(a,b,c){for(var d=a,e=b.length-1,g=0;g<e;g++)void 0===d[b[g]]&&(d[b[g]]={}),d=d[b[g]];d[b[e]]=c;return a}function y(a,b,c){return a.replace("%from",b).replace("%to",c)}var v="",q=window.nc_mixin_settings_editor=function(a){if(!(this instanceof q))return new q(a);for(var b in a)b in this&&(this[b]=
a[b]);this.scope=this.scope||this.field_name_prefix||"Index";a=f(this.target);a.html(f(".nc-mixins-editor-template").html());this.container=a.find(".nc-mixins-editor");this.lang=this.container.data("lang");this.set_field_names();this.init_breakpoint_type_container();this.find(".nc-mixins-breakpoint-type-select").val(this.breakpoint_type);this.breakpoints={};this.breakpoints[this.MAX_WIDTH]=this.MAX_WIDTH.toString();this.mixin_type_order=this.get_mixin_type_order();this.set_own_settings(this.own_settings);
this.init_preset_container();this.apply_preset_settings();this.rebuild_table();this.init_event_handlers();var c=this;this.find(".nc-mixins-mixin-settings-lock-sides-button").each(function(){c.init_lock_sides_button(f(this))});this.load_fonts();this.find("select.nc-mixins-mixin-font-select").each(function(){c.init_font_select(f(this))});this.init_color_inputs(this.find("[data-color-input]"));this.init_uploader(this.find("[data-uploader]"));this.is_initialized=!0;this.update_mixin_json()};q.mixin_settings_set_values_event=
"mixin_settings_set_values_event";q.mixin_settings_new_row_event="mixin_settings_new_row_event";q.breakpoint_type_change_event="breakpoint_type_change";q.prototype={MAX_WIDTH:9999,is_initialized:!1,target:"#nc_mixins_editor_container",field_name_template:"data[%s]",field_name_prefix:"",scope:null,mixin_presets:[],own_settings:{},breakpoint_type:"block",component_template_id:void 0,infoblock_id:void 0,show_preset_select:!1,show_breakpoint_type_select:!1,lang:{},fonts:[],container:null,selectors:{},
breakpoints:{},inherited_settings:{},temporary_own_settings:{},mixin_type_order:[],calculated_colors:{},constructor:q,find:function(a){return this.container.find(a)},init_event_handlers:function(){var a=this;this.find(".nc-mixins-preset-select").change(f.proxy(this,"on_preset_select_change"));this.find(".nc-mixins-preset-actions .nc--edit").click(f.proxy(this,"open_preset_edit_dialog"));this.find(".nc-mixins-preset-actions .nc--remove").click(f.proxy(this,"open_preset_delete_dialog"));this.find(".nc-mixins-breakpoint-type-select").change(f.proxy(this,
"on_breakpoint_type_select_change")).change();this.find(".nc-mixins-selector-select").change(f.proxy(this,"on_selector_select_change"));this.container.on("click",".nc-mixins-breakpoint-add-button",f.proxy(this,"show_new_breakpoint_dialog"));this.container.on("click",".nc-mixins-breakpoint",f.proxy(this,"show_edit_breakpoint_dialog"));this.container.on("click",".nc-mixins-add-setting, .nc-mixins-settings-marker",f.proxy(this,"show_mixin_settings"));this.container.on("click",".nc-mixins-settings-cell:not(.nc--active)",
function(){var b=f(this).prev(),c=b.find(".nc-mixins-settings-marker");c.length?c.click():b.find(".nc-mixins-add-setting").click()});this.container.on("change",".nc-mixins-mixin-select",function(){a.on_mixin_select_change(f(this),!1)});this.container.on("change input",".nc-mixins-mixin-settings :input",f.proxy(this,"update_current_mixin_settings"));this.container.on("click",".nc-mixins-mixin-remove",f.proxy(this,"on_remove_settings_button_click"));this.container.on("click",".nc-mixins-mixin-settings-row-add",
f.proxy(this,"on_mixin_multiple_settings_add_button_click"));this.container.on("click",".nc-mixins-mixin-settings-row-remove",f.proxy(this,"on_mixin_multiple_settings_remove_button_click"))},get_field_name:function(a){return this.field_name_template.replace("%s",(this.field_name_prefix?this.field_name_prefix+"_":"")+a)},set_field_names:function(){var a={".nc-mixins-json":"Mixin_Settings",".nc-mixins-preset-select":"Mixin_Preset_ID",".nc-mixins-breakpoint-type-select":"Mixin_BreakpointType"},b;for(b in a)this.find(b).attr("name",
this.get_field_name(a[b]))},get_mixin_input_values:function(a){var b={};a.find("input, select, textarea").filter('[name^="mixin."]').each(function(){var c=f(this),d=this.name.replace(/^mixin\./,""),e=c.val();if(!c.is(":radio")||c.is(":checked")){if(0<=d.indexOf("#")){if(c.closest(".nc-mixins-mixin-settings-row-template").length)return;var g=c.closest(".nc-mixins-mixin-settings-row");g=g.parent().children().index(g);0<=g&&(d=d.replace(/#/g,g))}c.is(":checkbox")?b[d]=c.is(":checked")?e:"":c.is('[data-color-input][data-nc-swatches][data-sync-color^="var"]')?
b[d]=c.attr("data-sync-color"):b[d]=e}});return b},set_inherited_settings:function(a){var b=!f.isEmptyObject(this.inherited_settings),c=!f.isEmptyObject(a);if(c){b=Object.keys(this.breakpoints);var d=this.get_breakpoints_as_array_from_settings(a);b=b.filter(function(g){return 0>d.indexOf(g)});if(b.length){for(var e=0;e<b.length;e++)this.remove_breakpoint(b[e]);this.after_breakpoint_change()}}else b&&this.set_own_settings(f.extend({},this.inherited_settings,this.own_settings));this.container.toggleClass("nc-mixins-editor--with-preset",
c);this.inherited_settings=a;this.extract_selectors_and_breakpoints(a)},set_own_settings:function(a){this.own_settings=a;this.extract_selectors_and_breakpoints(a)},extract_selectors_and_breakpoints:function(a){for(var b in a){this.selectors[b]=b;for(var c in a[b])for(var d in a[b][c])this.breakpoints[d]=d}this.sort_breakpoints();this.on_breakpoint_number_change();this.update_selectors_select()},get_breakpoints_as_array_from_settings:function(a){var b={},c;for(c in a)for(var d in a[c])for(var e in a[c][d])b[e]=
e;return Object.keys(b)},sort_breakpoints:function(){var a=Object.keys(this.breakpoints).sort(function(d,e){return d-e});this.breakpoints={};for(var b=0;b<a.length;b++){var c=a[b];this.breakpoints[c]=c}},sort_mixins:function(a){var b={};f.each(this.mixin_type_order,function(c,d){d in a&&(b[d]=a[d])});return b},get_mixin_type_order:function(){var a=[];this.find(".nc-mixins-mixin-row").each(function(){a.push(f(this).data("mixinType"))});return a},on_breakpoint_number_change:function(){this.container.attr("data-breakpoint-number",
Object.keys(this.breakpoints).length)},show_new_breakpoint_dialog:function(a){var b=f(a.target).closest("td");a=parseInt(b.data("breakpoint"),10);b=parseInt(b.prev().data("breakpoint"),10)||0;var c=this.lang,d=c.BREAKPOINT_ADD_PROMPT;if(b||a)d+=" "+y(c.BREAKPOINT_ADD_PROMPT_RANGE,b,a);(c=parseInt(prompt(d+":"),10))&&c>b&&c<a&&this.add_new_breakpoint(c)},add_new_breakpoint:function(a){this.breakpoints[a]=a;this.sort_breakpoints();this.on_breakpoint_number_change();this.rebuild_table()},show_edit_breakpoint_dialog:function(a){if(!this.container.is(".nc-mixins-editor--with-preset")){a=
f(a.target).closest(".nc-mixins-width").data("breakpoint");var b=prompt(this.lang.BREAKPOINT_CHANGE_PROMPT,a);b!=a&&null!==b&&(""===b||"0"===b?this.remove_breakpoint(a):this.replace_breakpoint(a,b),this.after_breakpoint_change())}},replace_breakpoint:function(a,b){var c=this.own_settings,d;for(d in c)for(var e in c[d])c[d][e][a]&&(c[d][e][b]=c[d][e][a]);this.breakpoints[b]=b;this.remove_breakpoint(a)},remove_breakpoint:function(a){var b=this.own_settings,c;for(c in b)for(var d in b[c])delete this.own_settings[c][d][a];
delete this.breakpoints[a]},after_breakpoint_change:function(){this.temporary_own_settings={};this.close_opened_mixin_settings();this.sort_breakpoints();this.on_breakpoint_number_change();this.rebuild_table();this.update_mixin_json()},update_selectors_select:function(a){var b=this.find(".nc-mixins-selector-select"),c=b.find("option:last"),d=Object.keys(this.selectors).sort();void 0===a&&(a=b.val());b.find(".nc-mixins-selector-select-selector").remove();for(var e=0;e<d.length;e++){var g=d[e];g&&f("<option>",
{value:g,text:g,"class":"nc-mixins-selector-select-selector"}).insertBefore(c)}b.val(a in this.selectors?a:"").change()},rebuild_table:function(){var a=Object.keys(this.breakpoints).map(Number);this.temporary_own_settings={};this.rebuild_table_head_width_ranges(a);this.rebuild_table_body_width_ranges(a)},rebuild_table_head_width_ranges:function(a){var b=a.length,c="";this.find(".nc-mixins-width-icon").prop("colspan",b);this.find(".nc-mixins-width").remove();for(var d=0;d<b;d++){var e=a[d];c+='<td class="nc-mixins-width nc-mixins-width-head" data-breakpoint="'+
e+'"><div class="nc-mixins-breakpoint-add-button-container"><div class="nc-mixins-breakpoint-add-button" title="'+this.lang.BREAKPOINT_ADD+'">+</div></div><div class="nc-mixins-breakpoint"><span>'+(e>=this.MAX_WIDTH?"&#x2731;":e)+"</span></div></td>"}c=f(c);c.first().addClass("nc-mixins-width--first");c.last().addClass("nc-mixins-width--last");this.find(".nc-mixins-width-ranges").prepend(c)},rebuild_table_body_width_ranges:function(a){var b=this;this.find(".nc-mixins-mixin-row").each(function(){var c=
f(this),d="",e=a.length;c.find(".nc-mixins-width").remove();for(var g=0;g<e;g++)d+='<td class="nc-mixins-width" data-breakpoint="'+a[g]+'"><div class="nc-mixins-add-setting-container"><div class="nc-mixins-add-setting">+</div></div></td>';d=f(d);d.first().addClass("nc-mixins-width--first");d.last().addClass("nc-mixins-width--last");c.prepend(d);b.update_row_markers(c);d=c.data("mixin-scopes")||[];c.toggle(-1!==d.indexOf(b.scope))})},update_row_markers:function(a){var b=-1,c=0,d=a.find(".nc-mixins-mixin-type-name").html(),
e=this,g=a.data("mixinType");a.find(".nc-mixins-width").each(function(h){var k=f(this),l=k.data("breakpoint"),m=e.make_range_description(c,l);k.prop("title",d+" "+m).data("range",m);k.find(".nc-mixins-settings-marker, .nc-mixins-base-settings-marker").remove();k.removeClass(function(r,t){return(t.match(/\bnc-mixins-width--span-\S+/g)||[]).join(" ")});1<h-b&&k.addClass("nc-mixins-width--span-"+(h-b));m=!!e.get_settings(e.own_settings,g,l)||!!e.get_settings(e.temporary_own_settings,g,l);var p=!!e.get_settings(e.inherited_settings,
g,l),n=e.get_current_selector()&&!!e.get_settings(e.own_settings,g,l,"");m?k.append('<div class="nc-mixins-settings-marker nc-mixins-own-settings-marker">\u25cf</div>'):p?k.append('<div class="nc-mixins-settings-marker nc-mixins-inherited-settings-marker">\ud83e\udc61</div>'):n&&k.append('<div class="nc-mixins-base-settings-marker">\u25cb</div>');k.toggleClass("nc-mixins-width--with-own-settings",m);k.toggleClass("nc-mixins-width--with-inherited-settings",p);if(m||p)b=h,c=l})},get_active_cell_position:function(){var a=
this.container.find(".nc-mixins-settings-marker.nc--active");if(!a.length)return null;a=a.closest(".nc-mixins-width");var b=a.closest(".nc-mixins-mixin-row");return{row:b.closest("tbody").children().index(b),cell:b.children().index(a)}},restore_active_cell_position:function(a){a&&this.container.find(".nc-mixins-table tbody").children().eq(a.row).children().eq(a.cell).find(".nc-mixins-settings-marker, .nc-mixins-add-setting").first().click()},get_current_selector:function(){return this.find(".nc-mixins-selector-select").val()},
on_selector_select_change:function(){if("+"===this.find(".nc-mixins-selector-select").val())this.show_add_selector_dialog();else{var a=this.get_active_cell_position();this.rebuild_table();this.restore_active_cell_position(a)}},show_add_selector_dialog:function(){var a=prompt(this.lang.SELECTOR_ADD_PROMPT);!a||a in this.selectors||(this.selectors[a]=a);this.update_selectors_select(a||"")},get_settings:function(a,b,c,d){var e;(e=a[void 0===d?this.get_current_selector():d])&&(e=e[b])&&(e=e[c]);return e},
remove_settings:function(a,b,c){var d=this.get_current_selector();a[d]&&a[d][b]&&(delete a[d][b][c],f.isEmptyObject(a[d][b])&&delete a[d][b])},make_range_description:function(a,b){if(2>Object.keys(this.breakpoints).length)return"";var c=this.breakpoint_type;c="FOR_"+(c?c.toUpperCase()+"_":"")+"WIDTH_";c=0==a?c+(b==this.MAX_WIDTH?"ANY":"TO"):b==this.MAX_WIDTH?c+"FROM":c+"RANGE";return y(this.lang[c]||"",a,b-1)},init_breakpoint_type_container:function(){var a=this.find(".nc-mixins-breakpoint-type-container");
this.show_breakpoint_type_select?a.show():a.hide().find("select").attr("name","")},set_breakpoint_type_from_select:function(){this.breakpoint_type=this.find(".nc-mixins-breakpoint-type-select").val()||""},on_breakpoint_type_select_change:function(){var a=this;a.set_breakpoint_type_from_select();a.find(".nc-mixins-mixin-row").each(function(){var b=f(this),c=a.get_active_cell_position();a.update_row_markers(b);a.restore_active_cell_position(c)});this.container.trigger(q.breakpoint_type_change_event,
[{editor:this}])},on_preset_select_change:function(){"+"===this.find(".nc-mixins-preset-select").val()?this.open_preset_edit_dialog():this.apply_preset_settings()},open_preset_edit_dialog:function(){var a=this.get_selected_preset_option(),b=a.data("id");a="+"===a.val();var c={component_template_id:this.component_template_id,"data[Scope]":this.scope};if("0"!==b){a?c["data[Mixin_Settings]"]=this.find(".nc-mixins-json").val():c.mixin_preset_id=b;var d=this;nc.load_dialog(this.container.data("preset-edit-dialog-url"),
c,"POST").set_option("on_submit_response",function(e){e=parseInt(e,10);var g=this.find('input[name="data[Mixin_Preset_Name]"]').val(),h=this.find(".nc-mixins-json").val(),k=this.find(':checkbox[name="set_as_default"]').is(":checked");e&&d.update_preset(e,g,h,k);this.destroy()});a&&this.find(".nc-mixins-preset-select").val("-1").change()}},open_preset_delete_dialog:function(){var a={mixin_preset_id:this.get_selected_preset_option().data("id")},b=this;nc.load_dialog(this.container.data("preset-delete-dialog-url"),
a,"POST").set_option("on_submit_response",function(c){(c=parseInt(c,10))&&b.delete_preset(c);this.destroy()})},init_preset_container:function(){var a=this.find(".nc-mixins-preset-container");this.show_preset_select?(this.init_preset_select(a),a.show()):a.hide().find("select").attr("name","")},init_preset_select:function(a){var b=a.find(".nc-mixins-preset-select");b.find("option").remove();this.mixin_presets.length?f.each(this.mixin_presets,function(c,d){f("<option>").attr({value:d.value,selected:d.selected,
"data-id":d.id,"data-settings":d.settings}).html(d.name).appendTo(b)}):b.append("<option>");b.append('<option value="+">'+this.lang.PRESET_CREATE)},update_preset:function(a,b,c,d){var e=this.find(".nc-mixins-preset-select"),g=e.find('option[data-id="'+a+'"]'),h=e.find('option[value="-1"]'),k=h.data("id")==a;g.length||(g=f("<option>").val(a).insertBefore(e.find("option:last")),e.val(d?"-1":a));d&&(g=g.add(h));g.html(b).attr({"data-id":a,"data-settings":c}).data({id:a,settings:JSON.parse(c)});d?h.html(this.lang.PRESET_DEFAULT.replace("%s",
b)):k&&this.remove_default_preset(a);e.change()},delete_preset:function(a){var b=this.find(".nc-mixins-preset-select");b.find('option[value="'+a+'"]').remove();this.remove_default_preset(a);b.val("-1").change()},remove_default_preset:function(a){this.find(".nc-mixins-preset-select").find('option[value="-1"][data-id="'+a+'"]').attr({"data-id":"0","data-settings":""}).data({id:0,settings:{}}).html(this.lang.PRESET_DEFAULT_NONE)},get_selected_preset_option:function(){return this.find(".nc-mixins-preset-select option:selected")},
apply_preset_settings:function(){if(this.show_preset_select){var a=this.get_selected_preset_option();this.set_inherited_settings(a.data("settings")||{});this.rebuild_table();this.find(".nc-mixins-preset-actions").toggle(!!a.data("id"));this.update_mixin_json()}},close_opened_mixin_settings:function(){var a=this;this.find(".nc-mixins-settings-cell.nc--active").removeClass("nc--active").each(function(){var b=f(this);if(b.is(".nc-mixins-settings-cell--temporary")){var c=b.closest("tr");a.remove_settings(a.temporary_own_settings,
c.data("mixinType"),b.data("breakpoint"));a.update_row_markers(c)}})},show_mixin_settings:function(a){a=f(a.target);var b=a.closest("td"),c=b.closest("tr"),d=c.find(".nc-mixins-settings-cell"),e=c.data("mixinType"),g=b.data("breakpoint");c=d.find(".nc-mixins-mixin-select");if(!a.is(".nc--active")){this.close_opened_mixin_settings();d.find(".nc-mixins-mixin-range-description").html(b.data("range"));d.data("breakpoint",g);d.addClass("nc--active");e=this.get_mixin_settings_values(e,g);g=e.mixin;var h=
d.find('.nc-mixins-mixin-settings[data-mixin-keyword="'+g+'"]');c.val(g||"");this.on_mixin_select_change(c,!0);this.set_mixin_input_values(h,e,!0);d.toggleClass("nc-mixins-settings-cell--temporary",!a.is(".nc-mixins-own-settings-marker"));a.is(".nc-mixins-add-setting")&&this.update_current_mixin_settings(!0);this.find(".nc-mixins-settings-marker").removeClass("nc--active");b.find(".nc-mixins-settings-marker").addClass("nc--active")}},set_mixin_input_values:function(a,b,c){a.find(".nc-mixins-mixin-settings-rows").children().remove();
for(var d in b)if(/^settings\.(.+\.)?lock_sides$/.test(d)){var e={};e[d]=b[d];b=f.extend(e,b)}for(d in b){var g=(d.match(/\.(\d+)\./)||[])[1];e=void 0!==g?this.get_mixin_multiple_settings_container(a,g):a;g="mixin."+d.replace("."+g+".",".#.");e=e.find('[name="'+g+'"]');e.is(":checkbox")?e.prop("checked",!!b[d]):e.is(":radio")?e.filter('[value="'+b[d].replace('"','\\"')+'"]').prop("checked",!0):e.is("[data-color-input]")?(e.attr("data-sync-color",b[d]),this.set_color_input(e,b[d])):e.val(b[d]);c&&
e.change()}a.trigger(q.mixin_settings_set_values_event,[{editor:this}])},get_mixin_multiple_settings_container:function(a,b){b=parseInt(b,10);var c=a.find(".nc-mixins-mixin-settings-rows"),d=c.find(".nc-mixins-mixin-settings-row"),e=d.length,g=a.find(".nc-mixins-mixin-settings-row-template");if(e>b)return d.eq(b);if(!c.length||!g.length)return a;for(d=a;e++<b+1;)d=g.clone().removeClass("nc-mixins-mixin-settings-row-template").appendTo(c),this.init_color_inputs(d.find("[data-color-input]")),this.init_uploader(d.find("[data-uploader]"));
0<g.find(".nc-mixins-mixin-settings-row-move").length&&c.sortable({handle:".nc-mixins-mixin-settings-row-move",containment:"parent",update:f.proxy(this,"update_current_mixin_settings")});return d},on_mixin_multiple_settings_add_button_click:function(a){a=f(a.target).closest(".nc-mixins-mixin-settings");var b=a.find(".nc-mixins-mixin-settings-rows .nc-mixins-mixin-settings-row").length;b=this.get_mixin_multiple_settings_container(a,b);a.trigger(q.mixin_settings_new_row_event,[{editor:this,row:b}]);
this.update_current_mixin_settings();return!1},on_mixin_multiple_settings_remove_button_click:function(a){f(a.target).closest(".nc-mixins-mixin-settings-row").remove();this.update_current_mixin_settings();return!1},get_mixin_settings_values:function(a,b){var c=this.get_settings(this.own_settings,a,b)||this.get_settings(this.inherited_settings,a,b);if(!c){var d=Object.keys(this.breakpoints).map(Number),e=d.indexOf(b);e<d.length-1&&(c=this.get_mixin_settings_values(a,d[e+1]))}return w(c||{})},on_mixin_select_change:function(a,
b){var c=a.closest(".nc-mixins-settings-cell");c.find(".nc-mixins-mixin-settings").hide().filter('[data-mixin-keyword="'+a.val()+'"]').show().trigger(q.mixin_settings_set_values_event,[{editor:this}]);b||(c.removeClass("nc-mixins-settings-cell--temporary"),this.update_current_mixin_settings())},update_current_mixin_settings:function(a){var b=this;b.find(".nc-mixins-settings-cell.nc--active").each(function(){var c=f(this),d=b.get_current_selector(),e=c.closest(".nc-mixins-mixin-row"),g=e.data("mixinType"),
h=c.find(".nc-mixins-mixin-select").val(),k=c.data("breakpoint"),l=!1,m="own_settings";!0===a?(l=!0,m="temporary_own_settings"):c.hasClass("nc-mixins-settings-cell--temporary")&&(c.removeClass("nc-mixins-settings-cell--temporary"),l=!0);x(b[m],[d,g,k],{mixin:h});c.find('.nc-mixins-mixin-settings[data-mixin-keyword="'+h+'"]').each(function(){var p=b.get_mixin_input_values(f(this)),n=f.extend,r=b[m][d][g][k],t={},u;for(u in p)x(t,u.split("."),p[u]);n.call(f,r,t)});l&&(b.update_row_markers(e),e.find('.nc-mixins-width[data-breakpoint="'+
k+'"] .nc-mixins-settings-marker').addClass("nc--active"))});!0!==a&&this.update_mixin_json()},update_mixin_json:function(){if(this.is_initialized){var a=f.extend({},this.own_settings),b;for(b in a)f.isEmptyObject(a[b])?delete a[b]:a[b]=this.sort_mixins(a[b]);this.find(".nc-mixins-json").val(JSON.stringify(a))}},on_remove_settings_button_click:function(a){var b=f(a.target).closest(".nc-mixins-settings-cell");a=b.closest("tr");var c=a.data("mixinType");b=b.data("breakpoint");this.remove_settings(this.temporary_own_settings,
c,b);this.remove_settings(this.own_settings,c,b);this.update_row_markers(a);this.close_opened_mixin_settings();this.update_mixin_json()},init_lock_sides_button:function(a){var b=a.closest(".nc-mixins-mixin-settings-lock-sides, .nc-mixins-mixin-settings"),c=b.find(':hidden[name^="mixin.settings"][name$=".lock_sides"]'),d=b.find(":input");c.change(function(){a.removeClass("nc-icon-lock nc-icon-unlock").addClass(c.val()?"nc-icon-lock":"nc-icon-unlock")}).change();a.click(function(){c.val(c.val()?"":
"1").change();d.filter('[name*="top"]').change()});var e=/(top|right|bottom|left)/;d.on("change input blur",function(){if("1"===c.val()){var g=this.attributes,h=f(this).val(),k=new RegExp(this.name.replace(/\./g,"\\.").replace(e,"(top|right|bottom|left)")),l=d.filter(function(){return this.name&&this.name.match(k)});l.val(h);f.each(g,function(m,p){p.name.indexOf("data-sync-")||l.attr(p.name,p.value)});d.filter(".minicolors-input").each(function(){var m=f(this);m.minicolors("value",m.val())})}})},
get_font_options_html:function(){v||f.each(this.fonts,function(a,b){v+="<option name='"+b.name+"' data-asset='"+b.asset+"' data-fallback='"+b.fallback+"' style='font-family:&quot;"+b.name+"&quot;'>"+b.name+"</option>"});return v},init_font_select:function(a){a.html(a.html()+this.get_font_options_html())},init_color_inputs:function(a){var b=this.infoblock_id?this.infoblock_id:0,c=f(".tpl-block-"+b+", .tpl-container-"+b),d={format:"rgb",keywords:"transparent",opacity:!0,swatches:[],theme:"netcat"},
e=["--tpl-color-foreground-main","--tpl-color-foreground-accent","--tpl-color-brand","--tpl-color-background-accent","--tpl-color-background-main"],g={};0<b&&0<c.length&&(f.each(e,function(h,k){var l=getComputedStyle(c[0]).getPropertyValue(k);l&&(d.swatches.push({name:"var("+k+")",color:l.trim()}),g["var("+k+")"]=l.trim())}),0<d.swatches.length&&a.each(function(){var h=f(this);g.hasOwnProperty(h.attr("data-sync-color"))&&h.val(g[h.attr("data-sync-color")])}));this.calculated_colors=g;a.minicolors("destroy").minicolors(d);
"undefined"!==typeof a.data("nc-swatches")&&(f(".minicolors-swatch-color").on("click",function(){var h=f(this);if(!h.attr("title"))return!0;h.closest(".minicolors-panel").siblings(".minicolors-input").attr("data-sync-color",h.attr("title"))}),f(".minicolors-panel *").on("click",function(h){h=f(h.target);if(h.is(".minicolors-swatches")||0<h.closest(".minicolors-swatches").length)return!0;f(this).closest(".minicolors-panel").siblings(".minicolors-input").attr("data-sync-color","").change()}))},set_color_input:function(a,
b){0===b.indexOf("var")&&this.calculated_colors.hasOwnProperty(b)?a.minicolors("value",{color:this.calculated_colors[b]}):a.minicolors("value",{color:b})},load_fonts:function(){var a=f("head");this.fonts=this.container.data("fonts");f.each(this.fonts,function(b,c){f.each(c.css,function(d,e){f('link[href="'+e+'"]',a).length||a.append(f("<link>",{rel:"stylesheet",href:e}))})})},get_infoblock_element:function(){var a=this.infoblock_id;return a?document.querySelector(".tpl-block-"+a+", .tpl-container-"+
a):null},init_uploader:function(a){var b=this;a.each(function(){var c=$nc(this),d=c.data("uploader-allowed"),e=c.data("uploader-ext"),g=c.find('input[type="url"]'),h=c.find('input[type="file"]'),k=c.find(".js-mixin-upload");e&&(e=e.split(/\s*,\s*/));k.on("click",function(){var l=c.closest(".nc-mixins-mixin-settings").data("mixin-keyword"),m=c.closest(".nc-mixins-editor").data("upload-max-filesize"),p=nc.ui.modal_dialog.get_current_dialog();c.dmUploader({url:NETCAT_PATH+"action.php?ctrl=admin.mixin_file&action=save&isNaked=1&admin_modal=1",
maxFileSize:m,multiple:!1,allowedTypes:d,extFilter:e,dataType:"json",extraData:{scope:b.scope,infoblock_id:b.infoblock_id,mixin_keyword:l},onDragEnter:function(){this.addClass("active")},onDragLeave:function(){this.removeClass("active")},onInit:function(){h.trigger("click")},onComplete:function(){c.dmUploader("destroy")},onBeforeUpload:function(n){g.addClass("nc--loading")},onUploadSuccess:function(n,r){g.removeClass("nc--loading").val(r.url).trigger("change")},onUploadError:function(n,r,t,u){c.dmUploader("destroy")},
onFallbackMode:function(){try{p.show_error("\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432")}catch(n){alert("\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432")}c.dmUploader("destroy")},
onFileSizeError:function(n){try{p.show_error("\u0424\u0430\u0439\u043b '"+n.name+"' \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0431\u043e\u043b\u044c\u0448\u043e\u0439")}catch(r){alert("\u0424\u0430\u0439\u043b '"+n.name+"' \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0431\u043e\u043b\u044c\u0448\u043e\u0439")}c.dmUploader("destroy")},onFileTypeError:function(n){try{p.show_error("\u0424\u0430\u0439\u043b '"+n.name+"' \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u0430\u0439\u043b\u043e\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f")}catch(r){alert("\u0424\u0430\u0439\u043b '"+
n.name+"' \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u0430\u0439\u043b\u043e\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f")}c.dmUploader("destroy")},onFileExtError:function(n){try{p.show_error("\u0424\u0430\u0439\u043b '"+n.name+"' \u0438\u043c\u0435\u0435\u0442 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442")}catch(r){alert("\u0424\u0430\u0439\u043b '"+n.name+"' \u0438\u043c\u0435\u0435\u0442 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442")}c.dmUploader("destroy")}})})})}}})($nc);