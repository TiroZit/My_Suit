(function(e){function A(a){var b=e(a),c=h(b),d=c.data("maxFiles"),f=c.data("fieldName"),g=function(a){return"multifile_"+a+"["+f+"][]"},t=r(a);b.hide().clone().val("").appendTo(c).show();b.removeClass("nc-upload-input").appendTo(c.find(".nc-upload-new-files"));e.each(t,function(k){var f=c.data("nextUploadIndex")||0;c.data("nextUploadIndex",f+1);1==t.length&&b.addClass("nc-upload-file-index--"+f);k=u(a,k).hide().data("uploadIndex",f).append(l(g("id")),l(g("upload_index"),f),l(g("delete"),0).addClass("nc-upload-file-remove-hidden"));
c.data("customName")&&(f=c.data("customNameCaption"),f=v("text",g("name"),"",f),e('<div class="nc-upload-file-custom-name"/>').append(f).appendTo(k));d&&"0"!=d&&w(c)>=d?x(k):k.slideDown(100)});m(c)}function u(a,b){var c=r(a)[b],d=e('<div class="nc-upload-file"><div class="nc-upload-file-info"><span class="nc-upload-file-name">'+c.name+'</span> <a href="#" class="nc-upload-file-remove" tabindex="-1">\u00d7</a></div></div>');a=h(a).find(".nc-upload-files");n&&5242880>c.size&&y(c.type)?(b=new FileReader,
b.onload=function(a){p(d,c.type,c.name,a.target.result,!0)},b.readAsDataURL(c)):p(d,c.type,c.name,null,!0);d.appendTo(a);z(d);return d}function p(a,b,c,d,f){var g=e("<div/>").addClass("nc-upload-file-preview nc-upload-file-drag-handle");(b=d&&y(b))&&n?(g.addClass("nc-upload-file-preview-image").append('<img src="'+d+'" />'),h(a).addClass("nc-upload-with-preview")):(d=c.lastIndexOf("."),g.addClass("nc-upload-file-preview-other"),0<d&&g.append('<span class="nc-upload-file-extension">'+c.substr(d+1)+
"</span>"));a.prepend('<div class="nc-upload-file-drag-icon nc-upload-file-drag-handle"><i class="nc-icon nc--file-text"></i></div>',g);(b||a.closest(".nc-upload-with-preview").length)&&n&&(f?g.slideDown(100):g.show());return g}function y(a){return/^image\/(jpe?g|png|gif|bmp|webp|svg([+-]xml)?)$/i.test(a)}function r(a){return n?a.files:[{name:a.value.substr(a.value.lastIndexOf("\\")+1),type:"",size:0}]}function q(a){return a.hasClass("nc-upload-multifile")}function h(a){return e(a).closest(".nc-upload")}
function w(a){return a.find(".nc-upload-file").filter(function(){return"none"!==e(this).css("display")}).length}function m(a){var b=q(a)?a.data("maxFiles"):1;b&&a.find(".nc-upload-input").toggle(w(a)<b)}function l(a,b){return v("hidden",a,b)}function v(a,b,c,d){return e("<input />",{type:a,name:b,value:void 0===c?"":c,placeholder:d||""})}function B(a){a.preventDefault();a.stopPropagation();a=e(a.target).closest(".nc-upload-file");var b=h(a),c=b.find(".nc-upload-input"),d=c;x(a);q(b)?b.find(".nc-upload-file-index--"+
a.data("uploadIndex")).val(""):(d=c.clone().val("").show(),c.replaceWith(d));a.slideUp(100,function(){b.hasClass("nc-upload-with-preview")&&0==b.find(".nc-upload-file:visible .nc-upload-file-preview-image").length&&b.removeClass("nc-upload-with-preview");var a=e.Event("change");a.target=d[0];e(document).trigger(a);m(b)});return!1}function x(a){a.find(".nc-upload-file-remove-hidden").val(1).trigger("change")}function z(a){a.find(".nc-upload-file-remove").off("click.nc-upload").on("click.nc-upload",
B)}if(e){var n="FileReader"in window;e.fn.upload=function(){return this.each(function(){var a=e(this);if(!a.hasClass("nc-upload-applied")){a.addClass("nc-upload-applied");var b=q(a),c=a.find(".nc-upload-files"),d=c.find(".nc-upload-file");0<d.length&&!b&&a.find(".nc-upload-input").hide();d.each(function(){var a=e(this),c=a.data("type"),b=a.find(".nc-upload-file-name"),d=b.html();b=b.data("preview-url")?b.data("preview-url"):b.prop("href");p(a,c,d,b,!1)});setTimeout(function(){m(a)},10);a.on("change",
".nc-upload-input",function(){b?A(this):this.value&&(u(this,0).hide().slideDown(100).find(".nc-upload-file-custom-name input:text").focus(),m(h(this)))});c.find(".nc-upload-file-remove").attr("onclick","");z(c);b&&a.append(l("multifile_js["+a.data("fieldName")+"]",1));if(b){var f;c.on("mousedown",".nc-upload-file-drag-handle",function(a){a.preventDefault();c.addClass("nc--dragging");f=e(this).closest(".nc-upload-file").addClass("nc--dragged");e(window).on("mouseup.nc-upload",function(){c.removeClass("nc--dragging");
f.removeClass("nc--dragged");e(window).off("mouseup.nc-upload");f=null})});c.on("mousemove",".nc-upload-file",function(a){var b=e(this);if(f&&!b.hasClass("nc--dragged")){if("none"==b.css("float")){a=a.pageY-b.offset().top;var c=b.height();a=a<c/2}else a=a.pageX-b.offset().left,c=b.width(),a=a<c/2;a?f.insertBefore(b):f.insertAfter(b)}})}}})};e(document).on("apply-upload",function(a){e(".nc-upload").upload()})}})(window.$nc||window.jQuery);
